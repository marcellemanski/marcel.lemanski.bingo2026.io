<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tapflo BINGO 2026</title>
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            font-family: system-ui, -apple-system, 'Segoe UI', sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            margin: 0; padding: 10px; min-height: 100vh; color: #333; 
            overscroll-behavior: none;
        }
        .container { 
            max-width: 100%; width: 100%; margin: 0 auto; background: white; 
            border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.15); 
            overflow: hidden; max-width: 800px;
        }
        h1 { 
            text-align: center; background: linear-gradient(135deg, #ff6b6b, #ff8e8e); 
            color: white; margin: 0; padding: 18px 10px; 
            font-size: clamp(1.2em, 5vw, 1.6em); font-weight: 700; 
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        .status { 
            text-align: center; font-size: clamp(1em, 4vw, 1.2em); font-weight: 700; 
            margin: 12px 0; min-height: 45px; padding: 12px 16px; 
            border-radius: 15px; background: rgba(255,255,255,0.95); 
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .bingo-grid { 
            display: grid; grid-template-columns: repeat(5, 1fr); 
            gap: clamp(4px, 1.5vw, 8px); 
            padding: clamp(12px, 3vw, 20px); 
            justify-items: center; max-width: 100%;
        }
        .cell { 
            position: relative;
            width: 100%; height: 0; padding-bottom: 100%; 
            border: 2.5px solid #ddd; border-radius: 12px; 
            cursor: pointer; touch-action: manipulation;
            transition: all 0.25s ease; overflow: hidden; 
            background: #fff; box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
        }
        .text-wrap { 
            position: absolute; top: 50%; left: 50%; 
            transform: translate(-50%, -50%);
            width: calc(100% - 8px); height: calc(100% - 8px);
            display: flex; align-items: center; justify-content: center; 
            text-align: center; padding: 2px; 
            font-weight: 600; font-size: 12px;
            line-height: 1.1; word-break: break-word; 
            hyphens: auto; white-space: normal;
            overflow: hidden;
        }
        .cell:active { transform: scale(0.96) !important; transition: 0.1s; }
        .cell:hover:not(.free) { transform: scale(1.02); box-shadow: 0 6px 16px rgba(0,0,0,0.2); }
        .cell.marked { 
            background: linear-gradient(135deg, #4ecdc4, #44a08d); 
            border-color: #44a08d; 
            animation: pop 0.3s ease-out; box-shadow: 0 4px 12px rgba(68,160,141,0.4);
        }
        .cell.marked .text-wrap { color: white; }
        .cell.free { 
            background: linear-gradient(135deg, #ffd93d, #ff6b6b); 
            border-color: #ff6b6b; cursor: default; 
            box-shadow: 0 4px 12px rgba(255,107,107,0.3);
        }
        .cell.free .text-wrap { 
            font-weight: 800; font-size: 13px;
            color: #333;
        }
        @keyframes pop { 
            0% { transform: scale(0.92); } 50% { transform: scale(1.08); } 100% { transform: scale(1); } 
        }
        .controls { 
            padding: 20px 16px; text-align: center; background: #f8f9fa; 
            display: flex; flex-wrap: wrap; gap: 12px; justify-content: center;
        }
        button { 
            background: linear-gradient(135deg, #ff6b6b, #ff5252); 
            color: white; border: none; padding: clamp(14px, 4vw, 18px) 28px; 
            border-radius: 28px; font-size: clamp(1em, 3.5vw, 1.1em); 
            cursor: pointer; transition: all 0.3s; font-weight: 700; 
            min-height: 52px; min-width: 140px;
            box-shadow: 0 4px 12px rgba(255,107,107,0.3);
            touch-action: manipulation;
        }
        button:hover, button:active { 
            background: linear-gradient(135deg, #ff5252, #ff4757); 
            transform: translateY(-2px); box-shadow: 0 8px 20px rgba(255,107,107,0.5); 
        }
        button:disabled { background: #ccc; cursor: not-allowed; transform: none; box-shadow: none; }
        .bingo-text { color: #4ecdc4; animation: glow 1s infinite alternate; }
        .full-bingo { 
            background: linear-gradient(135deg, #ffd700, #ffed4e); 
            color: #333; border: 4px solid #ffaa00; 
            animation: full-bingo-celebration 2s infinite; 
            font-size: clamp(1.1em, 4.5vw, 1.35em); 
            box-shadow: 0 8px 25px rgba(255,215,0,0.6);
        }
        @keyframes glow { from { text-shadow: 0 0 8px #4ecdc4; } to { text-shadow: 0 0 20px #4ecdc4; } }
        @keyframes full-bingo-celebration { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.04); } }

        @media (max-width: 480px) { 
            body { padding: 8px; } 
            .controls { padding: 16px 12px; flex-direction: column; }
            button { width: 100%; max-width: 280px; }
        }
        @media (max-width: 360px) { 
            h1 { padding: 15px 8px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé∞üé≤ Tapflo BINGO 2026 üéØ<br>üî• Spotkanie Kwartalne üé™</h1>
        <div class="status" id="status">Zaznaczaj zas≈Çyszane teksty - ka≈ºda pe≈Çna linia wygrywa. Nagroda specjalna za trafienie wszystkiego.</div>
        <div class="bingo-grid" id="grid"></div>
        <div class="controls">
            <button onclick="newGame()">üé≤ Nowa Gra</button>
            <button onclick="checkBingo()">‚úÖ Sprawd≈∫ BINGO</button>
        </div>
    </div>

    <script>
        const phrases = [
            "synergia",
            "strategiczny temat dla zarzƒÖdu",
            "dowiezienie rezultat√≥w",
            "zeskalowaƒá na inne rynki",
            "wr√≥cimy do tematu w kolejnym kwartale",
            "dziƒôkujƒô Ci za to pytanie",
            "a kt√≥ry Andrzej?",
            "mam pytanie, tak spontanicznie",
            "i co tam? Jesz?",
            "Krawiec zadaje pytanie po polsku do CEO",
            "Daniel m√≥wi o CTX'",
            "Koli≈Ñski narzeka za zbyt du≈ºy bud≈ºet",
            "Bia≈Çystok ma za du≈ºy bud≈ºet",
            "kwasiak",
            "mapowanie proces√≥w",
            "tego nie da siƒô sprzedawaƒá",
            "ewolucja a nie rewolucja",
            "konkurencja ma taniej",
            "jaka bran≈ºa?",
            "firma naszych by≈Çych koleg√≥w...",
            "≈Ça≈Ñcuch dostaw",
            "zysk operacyjny",
            "podziƒôkulski",
            "zysk ujemny",
			"Koli≈Ñski sugeruje Polagrƒô"
        ];

        let markedCells = new Set();
        const TOTAL_CELLS = 24;
        const STORAGE_KEY = 'tapflo_bingo_2026';
        const ORDER_KEY = 'tapflo_bingo_2026_order';

        if (phrases.length < 24) console.error('‚ö†Ô∏è Potrzebujesz minimum 24 hase≈Ç!');

        function saveProgress() { localStorage.setItem(STORAGE_KEY, JSON.stringify(Array.from(markedCells))); }
        
        function loadProgress() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                markedCells = new Set(JSON.parse(saved));
                document.querySelectorAll('.cell').forEach(cell => {
                    const index = parseInt(cell.dataset.index);
                    if (markedCells.has(index)) { cell.classList.add('marked'); }
                });
                updateStatus();
            }
        }
        
        function clearProgress() { localStorage.removeItem(STORAGE_KEY); markedCells.clear(); }

        /**
         * Dynamiczne zmniejszanie fontu a≈º tekst siƒô zmie≈õci w kontenerze
         * Obs≈Çuguje te≈º szeroko≈õƒá i wysoko≈õƒá jednocze≈õnie
         * Bez minimalnej wielko≈õci fontu
         */
        function fitTextToCell(textEl) {
            const container = textEl.parentElement;
            
            // Zmniejsz line-height dla d≈Çugich tekst√≥w
            const text = textEl.textContent;
            if (text.length > 50) {
                textEl.style.lineHeight = '1.0';
            } else if (text.length > 30) {
                textEl.style.lineHeight = '1.05';
            }
            
            let fontSize = 12;
            textEl.style.fontSize = fontSize + 'px';
            
            // Sprawdzaj zar√≥wno overflow wysoko≈õci jak i szeroko≈õci
            let attempts = 0;
            const maxAttempts = 300;
            
            while (attempts < maxAttempts) {
                // Wymu≈õ reflow
                const scrollHeight = textEl.scrollHeight;
                const scrollWidth = textEl.scrollWidth;
                const containerHeight = container.clientHeight;
                const containerWidth = container.clientWidth;
                
                // Je≈õli nie mie≈õci siƒô w wysoko≈õci lub szeroko≈õci
                if (scrollHeight > containerHeight - 4 || scrollWidth > containerWidth - 4) {
                    fontSize -= 0.15;
                    textEl.style.fontSize = fontSize + 'px';
                    attempts++;
                } else {
                    break;
                }
            }
            
            // Dla wolnego pola - nieco wiƒôkszy font
            if (textEl.textContent.includes('WOLNY')) {
                fontSize = 14;
                textEl.style.fontSize = fontSize + 'px';
                textEl.style.lineHeight = '1.1';
                let attempts2 = 0;
                while (attempts2 < maxAttempts) {
                    const scrollHeight = textEl.scrollHeight;
                    const scrollWidth = textEl.scrollWidth;
                    const containerHeight = container.clientHeight;
                    const containerWidth = container.clientWidth;
                    if (scrollHeight > containerHeight - 4 || scrollWidth > containerWidth - 4) {
                        fontSize -= 0.15;
                        textEl.style.fontSize = fontSize + 'px';
                        attempts2++;
                    } else {
                        break;
                    }
                }
            }
        }

        function createCell(i, orderedPhrases) {
            const cell = document.createElement('div');
            cell.className = 'cell';
            cell.dataset.index = i;
            
            const textWrap = document.createElement('div');
            textWrap.className = 'text-wrap';
            
            if (i === 12) {
                textWrap.textContent = 'üéÅ WOLNY LOS';
                cell.classList.add('free');
                if (!markedCells.has(12)) markedCells.add(12);
            } else {
                const phraseIndex = i > 12 ? i - 1 : i;
                textWrap.textContent = orderedPhrases[phraseIndex];
                cell.onclick = () => toggleCell(i);
            }
            
            cell.appendChild(textWrap);
            
            // Czekaj, a≈º element bƒôdzie w DOM, potem dostosuj
            // Wielokrotne wywo≈Çania by upewniƒá siƒô, ≈ºe font jest dostosowany na wszystkich urzƒÖdzeniach
            requestAnimationFrame(() => {
                fitTextToCell(textWrap);
            });
            
            // Dodatkowe op√≥≈∫nienia dla pewno≈õci
            setTimeout(() => fitTextToCell(textWrap), 50);
            setTimeout(() => fitTextToCell(textWrap), 150);
            
            return cell;
        }

        function getOrCreateOrder() {
            if (phrases.length < 24) return null;
            const savedOrder = localStorage.getItem(ORDER_KEY);
            if (savedOrder) return JSON.parse(savedOrder);
            const indices = []; 
            const available = [...Array(phrases.length).keys()];
            while (indices.length < 24) { 
                const randIdx = Math.floor(Math.random() * available.length); 
                indices.push(available.splice(randIdx, 1)[0]); 
            }
            localStorage.setItem(ORDER_KEY, JSON.stringify(indices));
            return indices;
        }

        function initGrid() {
            if (phrases.length < 24) { 
                document.getElementById('status').textContent = '‚ö†Ô∏è Dodaj min. 24 has≈Ça do `phrases`!'; 
                return; 
            }
            const order = getOrCreateOrder(); 
            if (!order) return;
            const orderedPhrases = order.map(i => phrases[i]);
            const container = document.getElementById('grid'); 
            container.innerHTML = '';
            for (let i = 0; i < 25; i++) { 
                container.appendChild(createCell(i, orderedPhrases)); 
            }
            loadProgress();
            
            // Ponowne dostosowanie po za≈Çadowaniu
            setTimeout(() => {
                document.querySelectorAll('.text-wrap').forEach(el => {
                    fitTextToCell(el);
                });
            }, 200);
        }

        function toggleCell(index) {
            const cell = document.querySelector(`[data-index="${index}"]`);
            if (markedCells.has(index)) { 
                markedCells.delete(index); 
                cell.classList.remove('marked'); 
            } else { 
                markedCells.add(index); 
                cell.classList.add('marked'); 
            }
            saveProgress(); 
            updateStatus();
        }

        function checkBingo() {
            const bingos = checkLines(); 
            const allMarked = markedCells.size === TOTAL_CELLS + 1; 
            const statusEl = document.getElementById('status');
            if (allMarked) { 
                statusEl.innerHTML = 'üèÜ <strong>DZIƒòKUJƒò CI ZA Tƒò GRƒò!</strong><br>Wygrywasz CTX-a i roczny wjazd na Podlasie! üèÜ'; 
                statusEl.className = 'status full-bingo'; 
            } else if (bingos > 0) { 
                statusEl.innerHTML = `üéâ BINGO! ${bingos} linii! üéâ`; 
                statusEl.className = 'status bingo-text'; 
            } else { 
                statusEl.textContent = 'Jeszcze nie ma BINGO...'; 
                statusEl.className = 'status'; 
            }
        }

        function checkLines() {
            let count = 0;
            // Sprawd≈∫ wiersze
            for (let row = 0; row < 5; row++) { 
                if ([0,1,2,3,4].map(c => row*5+c).every(i => markedCells.has(i))) count++; 
            }
            // Sprawd≈∫ kolumny
            for (let col = 0; col < 5; col++) { 
                if ([0,1,2,3,4].map(r => r*5+col).every(i => markedCells.has(i))) count++; 
            }
            // Sprawd≈∫ przekƒÖtne
            if ([0,6,12,18,24].every(i => markedCells.has(i))) count++;
            if ([4,8,12,16,20].every(i => markedCells.has(i))) count++;
            return count;
        }

        function newGame() {
            clearProgress(); 
            localStorage.removeItem(ORDER_KEY); 
            initGrid(); 
            document.getElementById('status').textContent = 'üé≤ Nowa losowa gra!';
        }

        function updateStatus() {
            const markedCount = markedCells.size; 
            const statusEl = document.getElementById('status');
            if (markedCount === TOTAL_CELLS + 1) { 
                statusEl.innerHTML = 'üèÜ DZIƒòKUJƒò CI ZA Tƒò GRƒò! Wygrywasz CTX-a i roczny wjazd na Podlasie! üèÜ'; 
                statusEl.className = 'status full-bingo'; 
            } else { 
                statusEl.textContent = markedCount >= 12 ? `Zaznaczono ${markedCount-1} p√≥l, dziƒôkujƒô Ci!` : 'Dziƒôkujƒô Ci za to zaznaczenie, graj dalej.'; 
            }
        }

        initGrid();
    </script>
</body>
</html>
